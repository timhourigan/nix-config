# Workflow to build Home Manager configuration from the flake
name: build-home-manager
run-name: Build Home Manager
on:
  push:
  pull_request:
jobs:
  build-hm:
    strategy:
      matrix:
        user: [timh]
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v4
      # https://github.com/cachix/install-nix-action
      - name: Install Nix
        uses: cachix/install-nix-action@v26
        with:
          nix_path: nixpkgs=channel:nixos-23.11
      # https://github.com/DeterminateSystems/magic-nix-cache-action
      - name: Cache Nix store
        uses: DeterminateSystems/magic-nix-cache-action@v2
      - name: Build
        run: |
          nix build --no-link .#homeConfigurations.${{ user.host }}@x13.activationPackage
          `nix path-info .#homeConfigurations.${{ user.host }}@x13.activationPackage`/activate
          home-manager --version
